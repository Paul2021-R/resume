# 잼잼 API 서버 릴리즈 히스토리

이 문서는 잼잼 API 서버의 주요 릴리즈 버전별 업데이트 내역을 정리한 문서이다. 각 버전에서 어떤 기능이 추가되고 어떤 버그가 수정되었는지 기록한다.

## API 2.1.1
*   **로깅 강화**: 로그를 더 자세히 남기도록 개선하였다.
*   **리워드 시스템 변경**:
    *   리워드 고정 보상 조건 변경으로 `firstPlay` 변수를 삭제하였다.
    *   리워드를 고정/랜덤으로 지급하는 로직을 추가하였다.
    *   첫 플레이 및 고정 보상 스테이지일 때만 고정 보상을 적용하고, 나머지는 랜덤 보상을 적용하도록 변경하였다.
    *   일일 알 최대 1개만 받도록 변경하였다.
*   **아이템 시스템 개선**:
    *   3레벨 이상 아이템은 현재 보유 중인 것들 중에만 나오도록 하고 테스트 코드를 작성하였다.
    *   레벨 4 아이템 소유 여부에 따라 다른 확률 테이블을 적용하였다.
*   **알림톡**: 알림톡 발송 여부를 데이터베이스에 저장하도록 하였다.
*   **사용자 관련**: 기존 사용자들에게 가입 치료 티켓을 지급하는 기능을 추가하였다.
*   **버그 수정**:
    *   루프 안의 `break` 코드 오류를 수정하였다.
    *   필수 아이템을 못 받고 지나갈 수 있는 케이스를 보완하였다.
    *   자동 로그인 상태에서 서버가 바뀔 때 로그인 오류 현상을 수정하였다.
*   **기타**: `ParticipantType`에 `admin`을 추가하였다.

## API 2.1.2
*   **구글 플레이 결제 연동**: 구글 플레이 결제 연동 및 검증 기능을 추가하였다.
*   **Swagger 문서 개선**: Swagger 문서에 이름과 버전을 반영하였다.
*   **새로운 AI 모델 적용**: 그레이딩 모델별 지표 수집을 위한 새로운 AI 모델을 적용하였다.

## API 2.2.1
*   **에러 핸들링 및 빌드 스크립트 개선**: Nest CLI 옵션 변경, 빌드 테스트 스크립트 생성, Agenda 모듈 URL 수정 등 에러 핸들링 및 빌드 관련 개선을 진행하였다.
*   **성능 개선 (Throttler)**: `Throttler`를 도입하여 인증 컨트롤러에 Rate Limiting을 적용하였다.
*   **테스트 계정 관리 API**: 유저 계정에 다중 테스트 계정 삽입 및 삭제 API를 개발하였다.
*   **사용자 및 자녀 컨트롤러/서비스 리팩토링**:
    *   MongoDB 특성을 고려하여 자녀 삭제 로직을 `remove`가 아닌 `relationship` 삭제로 변경하였다.
    *   변수명 수정, 가독성을 해치는 `map` 메서드 이중 구조 개선, `currentChild` 수정 로직 보완, `createManyWithChildren` 메서드명 수정 등 리팩토링을 진행하였다.
    *   유저 생성 과정 로직 일부를 컨트롤러에서 서비스로 이동하고, 티켓 및 가입 보상 누락 문제를 해결하였다.
*   **모션 API**: 5가지 동작에 대해 `gestureGuide`를 추가하였다.
*   **API 수정**: 삭제 과정 리팩토링 및 불필요한 부분 삭제를 진행하였다.
*   **패키지 관리**: `InMemory` 패키지를 삭제하였다.

## API 2.2.2
*   **버전 정보 추가**: API에 버전 정보를 추가하였다.
*   **케어 요약 보안 버그 핫픽스**: 케어 요약 관련 보안 버그를 핫픽스하였다.
*   **데이터 처리 개선**:
    *   데이터가 없는 경우 API에서 빈 배열을 전달하도록 개선하였다.
    *   DTO를 `Partial`로 래핑하여 불완전한 인자로도 수정 가능하도록 개선하였다.
*   **새로운 DTO 추가**: 보안에 문제가 될 내용 전송을 삭제하기 위해 새로운 DTO를 추가하였다.
*   **일일 로그 Public API 핫픽스**:
    *   일일 로그 치료 결과에 대한 Public API 버그를 수정하였다.
    *   수정 과정에서 사용성 향상을 위한 `find` 메서드 생성 방식(Prisma 제공 타입 활용)을 도입하였다.
    *   값이 `null`로 들어와도 문제없음을 확인하였다.
    *   MongoDB의 `relation`을 활용하기 용이하도록 공통 타입을 추가하였다.

## API 2.2.3
*   **로깅 점검 및 개선**: 스케줄링 모듈의 로거를 점검하고, 7월 9일 이후 로깅이 정상적으로 되지 않는 문제에 대응하기 위해 로깅을 추가하고 `try-catch`로 에러 발생을 로깅하도록 개선하였다.
*   **MongoDB URL 수정**: MongoDB URL을 수정하였다.
*   **자녀 등급 추가**: `Child` 모델에 `grade` 필드를 추가하였다.

## API 2.3.0
*   **로깅 통합 및 리팩토링**:
    *   로깅 통합 작업을 완료하였다.
    *   주석을 삭제하고 마스킹 기능을 건너뛰도록 리팩토링하였다.
    *   파일 로거 이름 수정 및 초기 로깅을 추가하였다.
    *   공통 모듈의 로깅 교체 작업을 완료하였다.
    *   Winston 로거 설정을 완료하였다.
*   **오늘 치료 결과 전송 기능 수정**: 오늘 치료 결과를 확인할 수 있도록 수정하였다.
*   **클리어 히스토리 수정**: 클리어 히스토리 관련 기능을 수정하였다.
*   **사용자 속성 및 임상 시험 리팩토링**: 사용자 속성 및 임상 시험 관련 리팩토링을 진행하였다.

## API 2.4.0
*   **시도 횟수 찾기 핫픽스**: 시도 횟수 찾기 관련 핫픽스를 진행하였다.
*   **자녀 ID 토큰에서 가져오기**: `childId`를 토큰에서 가져오도록 수정하였다.
*   **API 통신 수정**: API 통신 관련 문제를 수정하였다.
*   **현재 자녀 문제 핫픽스**: 현재 자녀 관련 문제를 핫픽스하였다.
*   **미니게임 관리 모듈**: 미니게임 관리 시스템 개발을 완료하였다.
*   **게임 설정 분리**: 게임 설정을 분리하여 독립적인 모듈로 만들었다.
*   **서버 URL API 완료**: 서버 URL API 개발을 완료하였다.
*   **API를 위한 설정**: API를 위한 설정을 추가하였다.
*   **ML URL API 완료**: ML URL API 개발을 완료하였다.

## API 2.5.0
*   **아산 임상 시험 개정**: 아산 임상 시험 관련 기능 개정 작업을 진행하였다.
    *   불필요한 코드를 삭제하였다.
    *   아산 임상 시험 서비스 이해를 돕기 위한 주석을 추가하였다.
    *   Prisma 모델링을 업데이트하였다.
    *   종료 상황 및 Unity와의 모든 테스트를 완료하였다.
    *   종료 상황을 추가하였다.
    *   아산 임상 시험 코드 개발을 완료하였다.
    *   치료 캘린더를 위한 컨트롤러 API 개발을 완료하였다.
    *   아산 기능 개발을 진행하였다.

## API 2.6.0
*   **레거시 코드 정리**: 레거시 코드 정리 작업을 진행하였다.
*   **자녀 진단 기록 추가**: 새로운 진단 기록 기능 추가 및 기본 관리 API 명세 작성을 완료하였다. 기존 일일 치료 기록 관련 수정 요청사항에 맞춰 아이템 리워드 히스토리를 전달하는 구조로 수정하였다.
*   **로그 파일 위치 추가**: 로그 파라미터에 파일 위치를 추가하였다.
*   **유효하지 않은 아이템 예외 처리**: `stage-configs`에 잘못된 아이템 ID가 있다면 확정 아이템으로 적용되지 않도록 수정하였다.
*   **관리자 강제 토큰 발급 API**: 관리자 강제 토큰 발급 API 개발을 완료하였다.

## API 2.7.0
*   **일일 로깅 리팩토링**: 일일 로깅 관련 리팩토링을 진행하였다.
*   **로그인 프로세스 리팩토링**: 로그인 프로세스 리팩토링을 진행하였다.
*   **코드 컨벤션 통합**: 코드 컨벤션 통합 작업을 진행하였다.
*   **`users/child` POST 에러 수정**: `users/child` POST 요청 시 발생하는 에러를 수정하였다.
*   **CI/CD 개선**:
    *   `deploy-to-dev.yaml` 파일명을 변경하고 업데이트하였다.
    *   `gemgem-hosted-test.yaml` 파일을 업데이트하였다.
    *   새로운 개발 CI/CD 테스트를 진행하였다.

## API 2.8.0
*   **로깅 이슈 핫픽스**: 로깅 이슈(`startTime undefined`)를 핫픽스하였다.
*   **미국 SMS 인증**: 미국 SMS 인증 기능 개발을 진행하였다.
*   **API 호환성**: `request-random/first` API의 하위 호환성을 추가하였다.
*   **테스트 코드 및 불필요한 코드 삭제**: 불필요한 부분 및 테스트 코드를 삭제하였다.
*   **예외 처리 조건 삭제**: 예외 처리를 위한 `if` 조건을 삭제하였다.
*   **`.gitignore` 업데이트**: `.gitignore` 파일을 업데이트하였다.
*   **새로운 스크립트 추가**: `kill`을 위한 새로운 스크립트를 추가하였다.

## API 2.9.0
*   **AuthExceptionFilter 추가**: `AuthExceptionFilter`가 빠진 것을 추가하였다.
*   **Agenda 자동 비활성화 수정**: Agenda 자동 비활성화 관련 버그를 수정하였다.
*   **Apple 재구독 업데이트**: Apple 재구독 관련 업데이트를 진행하였다.
*   **로컬 회원가입 개선**: 로컬 회원가입 시 이미 가입된 메일이면 가입 수단을 리턴하도록 변경하였다.
*   **Google 비교 조건 오류 수정**: Google 비교 조건 문자열 오류를 수정하였다.
*   **에러 핸들링 응답 바디 복구 추가**: 에러 핸들링을 위해 응답 바디 복구 기능을 추가하였다.
*   **iOS 취소 조건 추가**: iOS 취소 케이스에 대한 조건을 추가하였다.
*   **Google 마이그레이션 이슈 수정**: Google 마이그레이션 이슈를 수정하였다.

## API 2.10.0
*   **미니게임 결과 스위치 핫픽스**: 미니게임 결과 스위치 관련 핫픽스를 진행하였다.
*   **미니게임 결과 제한/잠금 리팩토링**: 미니게임 결과 제한 및 잠금 관련 리팩토링을 진행하였다.
*   **HTTP 요청 바디 제한 핫픽스**: HTTP 요청 바디 제한 관련 핫픽스를 진행하였다.
*   **Apple 관련 긴급 수정**: Apple 관련 긴급 수정을 진행하였다.
*   **Signed Date 핫픽스**: Signed Date 관련 핫픽스를 진행하였다.
    *   `signedDate`가 없는 경우를 처리하기 위해 `transactionInfo`를 대체하도록 설정하였다.
*   **구독 개정**: 구독 개정 관련 작업을 진행하였다.
*   **요청 호출 문제 수정**: 요청이 호출되지 않는 문제를 수정하였다.

## API 2.11.0
*   **Notion 서비스 업데이트**: Notion 서비스 업데이트를 진행하였다.
*   **카카오톡 에러 핸들링 핫픽스**: 카카오톡 관련 에러 핸들링 핫픽스를 진행하였다.
*   **새로운 미니게임 설정**: 새로운 미니게임 설정 관련 작업을 진행하였다.
*   **일반 사용자 손 스케줄링**: 일반 사용자 손 스케줄링 기능을 추가하였다.
*   **새로운 회원가입 로직**: 새로운 회원가입 로직을 추가하였다.
*   **전체 사용자 관리자 API 제거**: 전체 사용자 관리자 API를 제거하였다.
*   **외부 API 모듈화**: 모든 외부 API 부분을 수정하고 모듈화하였다.
*   **에러 핸들링 수정**: 조건 오타로 인한 에러 핸들링을 수정하였다.

## API 2.12.0
*   **치료 캘린더 수정**: 치료 캘린더 관련 버그를 수정하였다.
*   **출석 기능 업데이트**: 출석 기능 관련 새로운 업데이트를 진행하였다.
*   **회원 탈퇴 로직 리팩토링**: 회원 탈퇴 로직 리팩토링을 진행하였다.
*   **미니게임 유효성 검사 오류 핫픽스**: 미니게임 유효성 검사 오류를 핫픽스하였다.
*   **DI 구조 개선**: DI(Dependency Injection) 구조 개선을 진행하였다.
*   **Discord 개선**: Discord 관련 개선을 진행하였다.
*   **컴파일러 빌드 구조 수정**: 컴파일러 빌드 구조를 수정하였다.

## API 3.0.0
*   **주요 변경 및 버전 업그레이드 이유**: API 3.0.0은 단순히 기존 기능의 개선을 넘어, **새로운 결제 시스템(구독 인상 대응, 스토어 이벤트 핸들링)의 대대적인 도입, 새로운 게임 콘텐츠(미니게임, VideoPinkfong)의 추가, 그리고 핵심 사용자 기능(운동 리포트)의 구현** 등 서비스의 핵심 비즈니스 로직과 사용자 경험에 큰 영향을 미치는 대규모 기능들이 통합된 버전이다. 또한, 이러한 대규모 변경 사항들을 안정적으로 서비스하기 위한 CI/CD 개선 및 여러 중요한 버그 수정이 동반되었다. 이러한 변화의 폭이 컸기 때문에 메이저 버전 업그레이드(2.x.x -> 3.0.0)가 이루어진 것으로 판단된다.
*   **새로운 스토어 이벤트 핸들링 및 구독 인상 대응**:
    *   구독 인상에 대한 핸들링 구현을 위한 레포지토리 작업이 진행되었다.
    *   새로운 스토어 이벤트 핸들링 기능이 완료되었고, 불필요한 플래그를 삭제하였다.
    *   Google 스토어 이벤트 핸들링이 완료되었다.
*   **미니게임 추가 및 기존 게임 구조 변경**:
    *   미니게임(`brushing-cooking`)이 추가되었다.
    *   UpStairs 게임의 1일 게임 제한 구조가 변경되고 VideoPinkfong 게임에 대한 구조 고려 설계가 변경되었다.
    *   VideoPinkfong 게임이 추가되었다.
*   **운동 리포트 기능 추가**: 메인 화면 운동 리포트를 위한 기능이 추가되었다.
*   **CI/CD 및 기타 개발 사항 개선**: CI/CD를 비롯한 기타 개발 사항에 대한 작업이 진행되었다.
*   **주요 버그 수정 및 안정화**:
    *   무료 체험 서버 시간 처리 API 버그를 수정하였다.
    *   출석 체크 기능 버그를 검토하였다.
    *   `getDate` 에러를 수정하였다.
    *   세션 TTL 고정 설정에 따른 403 발생 문제를 해결하였다.
    *   Prisma 타입 관련 수정을 진행하였다.

## API 3.1.0
*   **린트 설정 동기화**: 린트 설정 동기화 및 포맷팅 작업을 진행하였다.
*   **Google 구독 취소 API**: Google 구독을 업체에서 갱신 취소를 신청하는 API 기능을 탑재하였다.
*   **릴리즈 후 버그 수정**: 릴리즈 후 발생한 특정 버그를 수정하였다.

## API 3.1.1
*   **YouTube 관련 로직 추가**: YouTube 관련 새로운 로직을 추가하였다.
*   **구독 상태 수정 핫픽스**: 구독 상태 관련 버그를 수정하였다.
*   **로깅 개선**: 로깅 개선 작업을 진행하였다.
    *   URL 로깅에서 `health` 및 `/session` 체크를 건너뛰도록 수정하였다.
*   **구독 갱신 로직 수정**: 구독 갱신 로직을 수정하였다.

## API 3.1.2
*   **버전 변경**: 버전 변경 작업을 진행하였다.
*   **YouTube 관련 로직 추가**: YouTube 관련 새로운 로직을 추가하였다. (3.1.1 버전에서 추가된 내용의 추가 수정 또는 안정화로 추정된다.)

## API 3.1.3
*   **필수 아이템 체크 수정**: 필수 아이템 체크 관련 버그를 수정하였다.

